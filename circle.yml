general:
  branches:
    only:
      - master

machine:
  timezone:
    Asia/Tokyo
  node:
    version: 5.5.0
  environment:
    LARABEL_REPO: origin
    LARABEL_BRANCH: build
    NEXT_BUILD_PROJECT: laravel-prod-image
    CIRCLE_CI_API_KEY: 5aea22358cc6913340482940712d96da0297e20a


dependencies:
  pre:
    - node -v
    - npm -v
  override:
      - ls
    # - npm install
    # - npm update npm@3.7.2 -g
    # - npm rebuild node-sass


test:
  override:
    # - npm run test
    # - npm run build
    # - npm run build-admin
      - ls




deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    owner: circleci
    commands:
      - git clone -b master git@github.com:HoritaWorks/laravel_app.git
      - cp -fR webpack/dist laravel_app/public/dist-front
      - cp -fR webpack-admin/dist laravel_app/public/dist-back
      - mv release.sh laravel_app/
      - cd laravel_app && sh release.sh